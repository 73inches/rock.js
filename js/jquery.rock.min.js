(function(c){c.fn.rocks=function(j){var d={optionClass:"option",optionsClass:"options",optClass:"opt",openClass:"open",mobileClass:"rjsmo",mobileClassWP7:"rjswp7",plainClass:"rjsplain",searchTimeout:1E3,replace:!1,replaceChars:{"(":"<span>",")":"</span>"},onChange:function(){}},k=[],l=[],p=function(a){c.each(d.replaceChars,function(b,c){a=a.replace(b,c)});return a},m=function(a){var b=a.text();d.replace&&(b=p(b));return'<li role="option" data-value="'+a.attr("value")+'" class="'+d.optionClass+'"><button>'+ b+"</button></li>"},i=function(a){a.element.removeClass(d.openClass);a.open=!1;c(document.body).unbind("mouseup.rock").unbind("keyup.rock")},n=function(a){c(document.body).unbind("mouseup.rock").unbind("keyup.rock");c.each(l,function(){this.element.removeClass(d.openClass);this.open=!1});a.element.addClass(d.openClass);a.element.find("ul li button.active").focus();a.open=!0;c(document.body).bind({"mouseup.rock":function(b){a.element.has(c(b.target)).length||i(a)},"keyup.rock":function(b){b.which=== 27&&i(a)}})};return this.each(function(){var a=c(this);if(a.is("select")){var b={buttons:[]},h="",e=[],f=c("<ul/>",{"class":"rockdown"}),o=navigator.userAgent.toLowerCase();if(o.match(/(iphone|android|xblwp7|IEMobile)/))return a.addClass(d.plainClass),c(document.body).addClass(d.mobileClass),o.match(/(xblwp7|IEMobile)/)&&c(document.body).addClass(d.mobileClassWP7),jQuery;j&&c.extend(d,j);b.handleText=a.find("option:selected").text();e.push('<li><button class="handle" aria-valuetext="'+b.handleText+ '">'+b.handleText+"</button></li>");e.push("<li>");e.push('<ul class="'+d.optionsClass+'">');a.children().each(function(){var b=c(this);b.is("optgroup")?(e.push('<li class="'+d.optClass+'"><span>'+b.attr("label")+"</span>"),e.push("<ul>"),b.children("option").each(function(){var b=c(this);e.push(m(b))}),e.push("</ul>"),e.push("</li>")):e.push(m(b))});e.push("</ul>");e.push("</li></ul>");c("label[for="+a.attr("name")+"]").bind("click.rock",function(){f.find("button.handle").focus()});b.element=f.delegate("li.option button", "click.rock mouseup.rock",function(g){g.preventDefault();g=c(g.target);f.find("li button.active").removeClass("active");a.val(g.addClass("active").parent().attr("data-value"));f.find("button.handle").text(g.text()).attr("aria-valuetext",g.text());i(b);d.onChange.call(a)}).delegate("li.option button,button.handle","keydown.rock",function(a){if(a.which===40||a.which===38)h="",a.preventDefault(),b.buttons.each(function(c,d){a.target===d&&(a.which===40&&c+1<b.buttons.length&&b.buttons.get(c+1).focus(), a.which===38&&c>0&&b.buttons.get(c-1).focus())});else{c.each(k,function(){window.clearTimeout(this)});var e=window.setTimeout(function(){h=""},d.searchTimeout);k.push(e);h+=String.fromCharCode(a.which);b.buttons.each(function(){var a=c(this);b.$last=a;if(a.text().toLowerCase().indexOf(h.toLowerCase())===0)return b.open?a.hover().focus():a.trigger("click.rock"),!1})}}).delegate("ul li."+d.optionClass,"mouseover",function(){c(this).find("button").focus()}).delegate("button.handle","mousedown.rock,click.rock", function(a){f.find("button.handle").focus();a.stopPropagation();b.open?i(b):n(b)}).delegate("button.handle","mouseup.rock",function(a){a.stopPropagation();a.preventDefault()}).delegate("button.handle","keyup.rock",function(a){if(a.which===40||a.which===32)b.open?b.element.find("li.option:first button").focus():n(b)});f.append(e.join(""));b.buttons=f.find("li."+d.optionClass+" button");a.after(f);a.bind("change",function(){var a=c(this),b=a.val();f.find("button.handle").text(a.find("option[value="+ b+"]").first().text()).end().find("ul li[data-value="+b+"] button").addClass("active")});l.push(b)}else return jQuery})}})(jQuery);