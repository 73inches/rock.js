(function(a){a.fn.rocks=function(l){var e={optionClass:"option",optionsClass:"options",optClass:"opt",openClass:"open",onChange:function(){}},m=[],f={buildLi:function(b){return a("<li />",{"class":e.optionClass}).append(a("<button />",{text:a(b).text()}).data("val",a(b).val()))},close:function(b){b.removeClass(e.openClass);a("html").unbind("click.rock")},open:function(b){a.each(m,function(){this.removeClass(e.openClass)});b.addClass(e.openClass);a("html").one({"click.rock":function(){f.close(b)}, keyup:function(d){d.keyCode==27&&f.close(b)}})}};return this.each(function(){l&&a.extend(e,l);var b=a(this),d=null,g=a("<ul />",{"class":"rockdown"});a("<li />").append(a("<button />",{text:b.find(":selected").text(),"class":"handle"}).bind({"click.rock":function(c){c.stopPropagation();d.hasClass("open")?f.close(d):f.open(d)},keyup:function(c){c.keyCode==40&&f.open(d)}})).appendTo(g);var j=a("<ul />",{"class":e.optionsClass});b.children("option:not(:selected),optgroup").each(function(){if(a(this).is("optgroup")){j.append(a("<li />", {"class":e.optClass}).append(a("<span />",{text:a(this).attr("label")})));var c=a("<ul />");a(this).children().each(function(){f.buildLi(this).appendTo(c)});j.find("li."+e.optClass+":last").append(c)}else f.buildLi(this).appendTo(j)});g.append(a("<li />").append(j));d=g.delegate("li.option button","click.rock",function(c){b.val(a(c.target).data("val"));g.find("button.handle").text(a(c.target).text());f.close(d);e.onChange.call(b)}).delegate("li.option button","keyup",function(c){var h=d.find("button"); c.keyCode===40&&h.each(function(i,k){c.target===k&&i+1<h.length&&h.get(i+1).focus()});c.keyCode===38&&h.each(function(i,k){c.target===k&&i-1>0&&h.get(i-1).focus()})}).insertAfter(b);b.bind("change",function(){b=a(this);g.find("button.handle").text(b.find("option[value="+b.val()+"]").text())});m.push(d)})}})(jQuery);