(function(b){b.fn.rocks=function(j){var d={optionClass:"option",optionsClass:"options",optClass:"opt",openClass:"open",mobileClass:"rjsmo",mobileClassWP7:"rjswp7",plainClass:"rjsplain",searchTimeout:1E3,handleClass:"",handleMarkup:"",replace:!1,replaceChars:{"(":"<span>",")":"</span>"},onChange:function(){}},k=[],l=[],p=function(c){b.each(d.replaceChars,function(a,b){c=c.replace(a,b)});return c},m=function(b){var a=b.text();d.replace&&(a=p(a));return'<li role="option" data-value="'+b.attr("value")+ '" class="'+d.optionClass+'"><button>'+a+"</button></li>"},i=function(c){c.$element.removeClass(d.openClass);c.open=!1;b(document).unbind("click.rock").unbind("keyup.rock")},n=function(c){b(document).unbind("click.rock").unbind("keyup.rock");b.each(l,function(){this.$element.removeClass(d.openClass);this.open=!1});c.$element.addClass(d.openClass).find("ul li button.active").focus();c.open=!0;b(document).bind({"click.rock":function(a){b.contains(c.$element[0],a.target)||i(c)},"keyup.rock":function(a){a.which=== 27&&i(c)}})};return this.each(function(){var c=b(this);if(b.data(this,"rock"))return jQuery;else if(c.is("select")){var a={buttons:[],$handle:null},h="",f=[],g=b("<ul/>",{"class":"rockdown"}),o=navigator.userAgent.toLowerCase();if(o.match(/(iphone|android|xblwp7|IEMobile)/))return c.addClass(d.plainClass),b(document.body).addClass(d.mobileClass),o.match(/(xblwp7|IEMobile)/)&&b(document.body).addClass(d.mobileClassWP7),jQuery;j&&b.extend(d,j);a.handleText=c.find("option:selected").text();f.push('<li><button class="handle '+ d.handleClass+'" aria-valuetext="'+a.handleText+'">'+a.handleText+"</button></li>");f.push("<li>");f.push('<ul class="'+d.optionsClass+'">');c.children().each(function(){var a=b(this);a.is("optgroup")?(f.push('<li class="'+d.optClass+'"><span>'+a.attr("label")+"</span>"),f.push("<ul>"),a.children("option").each(function(){var a=b(this);f.push(m(a))}),f.push("</ul>"),f.push("</li>")):f.push(m(a))});f.push("</ul>");f.push("</li></ul>");b("label[for="+c.attr("name")+"]").bind("click.rock",function(a){a.preventDefault(); g.find("button.handle").focus()});a.$element=g.delegate("li.option button","click.rock",function(e){e=b(e.target);g.find("li button.active").removeClass("active");c.val(e.addClass("active").parent().attr("data-value"));g.find("button.handle").attr("aria-valuetext",e.text()).find('*:not(:has("*"))').text(e.text());i(a);d.onChange.call(c)}).delegate("li.option button","mouseup.rock",function(){b(this).trigger("click")}).delegate("li.option button,button.handle","keydown.rock",function(e){if(e.which=== 40||e.which===38)h="",e.preventDefault(),a.buttons.each(function(b,c){e.target===c&&(e.which===40&&b+1<a.buttons.length&&a.buttons.get(b+1).focus(),e.which===38&&b>0&&a.buttons.get(b-1).focus())});else{b.each(k,function(){window.clearTimeout(this)});var c=window.setTimeout(function(){h=""},d.searchTimeout);k.push(c);h+=String.fromCharCode(e.which);a.buttons.each(function(){var c=b(this);a.$last=c;if(c.text().toLowerCase().indexOf(h.toLowerCase())===0)return a.open?c.hover().focus():c.trigger("click.rock"), !1})}}).delegate("ul li."+d.optionClass,"mouseover",function(){b(this).find("button").focus()}).delegate("button.handle","mousedown.rock",function(b){b.preventDefault();g.find("button.handle").focus();a.open?i(a):n(a)}).delegate("button.handle","mouseup.rock",function(a){b(this).trigger("click");a.preventDefault()}).delegate("button.handle","keyup.rock",function(b){if(b.which===40||b.which===32)a.open?a.$element.find("li.option:first button").focus():n(a)});a.$handle=a.$element.find("button.handle"); g.append(f.join(""));g.find("button.handle").wrapInner(b(d.handleMarkup));a.buttons=g.find("li."+d.optionClass+" button");c.after(g);c.bind("change",function(){var a=b(this),c=a.val();g.find('button.handle :not(:has("*"))').text(a.find("option[value="+c+"]").first().text()).end().find("ul li[data-value="+c+"] button").addClass("active")});l.push(a);b.data(this,"rock",a)}else return jQuery})}})(jQuery);