(function(d){d.fn.rocks=function(l){var e={optionClass:"option",optionsClass:"options",optClass:"opt",openClass:"open",mobileClass:"rjsmo",mobileClassWP7:"rjswp7",plainClass:"rjsplain",searchTimeout:1E3,onChange:function(){}},m=[],n=[],i={buildLi:function(b){return'<li role="option" data-value="'+b.attr("value")+'" class="'+e.optionClass+'"><button>'+b.text()+"</button></li>"},close:function(b){b.element.removeClass(e.openClass);b.open=false;d(document).unbind("click.rock").unbind("keyup.rock")},
open:function(b){d(document).unbind("click.rock").unbind("keyup.rock");d.each(n,function(){this.element.removeClass(e.openClass);this.open=false});b.element.addClass(e.openClass);b.element.find("ul li button.active").focus();b.open=true;d(document).bind({"click.rock":function(){i.close(b)},"keyup.rock":function(c){c.which===27&&i.close(b)}})}};this.hide=function(){d(this).hide()};return this.each(function(){var b=d(this),c={buttons:[]},k,f=[],g=d("<ul/>",{"class":"rockdown"});if(!b.is("select"))return jQuery;
var o=navigator.userAgent.toLowerCase();if(o.match(/(iphone|android|xblwp7|IEMobile)/)){b.addClass(e.plainClass);d("body").addClass(e.mobileClass);o.match(/(xblwp7|IEMobile)/)&&d("body").addClass(e.mobileClassWP7);return jQuery}l&&d.extend(e,l);b.hide();c.handleText=b.find("option:selected").text();f.push('<li><button class="handle" aria-valuetext="'+c.handleText+'">'+c.handleText+"</button></li>");f.push("<li>");f.push('<ul class="'+e.optionsClass+'">');b.children().each(function(){var a=d(this);
if(a.is("optgroup")){f.push('<li class="'+e.optClass+'"><span>'+a.attr("label")+"</span>");f.push("<ul>");a.children("option").each(function(){var j=d(this);f.push(i.buildLi(j))});f.push("</ul>");f.push("</li>")}else f.push(i.buildLi(a))});f.push("</ul>");f.push("</li></ul>");d("label[for="+b.attr("name")+"]").bind("click.rock",function(){g.find("button.handle").focus()});c.element=g.delegate("li.option button","click.rock",function(a){a=d(a.target);g.find("li button.active").removeClass("active");
b.val(a.addClass("active").parent().attr("data-value"));g.find("button.handle").text(a.text()).attr("aria-valuetext",a.text());i.close(c);e.onChange.call(b)}).delegate("li.option button,button.handle","keydown.rock",function(a){if(a.which===40||a.which===38){a.preventDefault();c.buttons.each(function(h,p){if(a.target===p)if(a.which===40)h+1<c.buttons.length&&c.buttons.get(h+1).focus();else h>0&&c.buttons.get(h-1).focus()})}d.each(m,function(){window.clearTimeout(this)});var j=window.setTimeout(function(){k=
""},e.searchTimeout);m.push(j);k+=String.fromCharCode(a.which);c.buttons.each(function(){var h=d(this);c.$last=h;if(h.text().toLowerCase().indexOf(k.toLowerCase())===0)c.open?h.hover().focus():h.trigger("click.rock")})}).delegate("ul li."+e.optionClass,"mouseover",function(){d(this).find("button").focus()}).delegate("button.handle","click.rock",function(a){g.find("button.handle").focus();a.stopPropagation();c.open?i.close(c):i.open(c)}).delegate("button.handle","keyup.rock",function(a){if(a.which===
40)c.open?c.element.find("li.option:first button").focus():i.open(c)});g.append(f.join(""));c.buttons=g.find("li."+e.optionClass+" button");b.after(g);b.bind("change",function(){var a=d(this),j=a.val();g.find("button.handle").text(a.find("option[value="+j+"]").first().text()).end().find("ul li[data-value="+j+"] button").addClass("active")});n.push(c)})}})(jQuery);