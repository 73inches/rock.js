(function(a){a.fn.rocks=function(l){var j="",e={optionClass:"option",optionsClass:"options",optClass:"opt",openClass:"open",timeout:2E3,onChange:function(){}},m=[],n=[],f={buildButton:function(b){return a("<button />",{text:b.text()}).data("val",b.val())},buildLi:function(b){b=a(b);return a("<li />",{"class":e.optionClass,role:"option"}).append(f.buildButton(b))},close:function(b){b.element.removeClass(e.openClass);b.open=false;a(document).unbind("click.rock").unbind("keyup.rock")},open:function(b){a(document).unbind("click.rock").unbind("keyup.rock"); a.each(n,function(){this.element.removeClass(e.openClass);this.open=false});b.element.addClass(e.openClass);b.open=true;a(document).bind({"click.rock":function(){f.close(b)},"keyup.rock":function(c){c.keyCode==27&&f.close(b)}})}};return this.each(function(){var b=a(this);if(!b.is("select"))return jQuery;l&&a.extend(e,l);var c={buttons:[]},h=a("<ul />",{"class":"rockdown"});c.handleText=b.find("option:selected").text();a("<li />").append(a("<button />",{text:c.handleText,"class":"handle","aria-valuetext":c.handleText}).bind({"click.rock":function(d){d.stopPropagation(); c.open?f.close(c):f.open(c)},"keyup.rock":function(d){if(d.keyCode==40)c.open?c.element.find("li.option:first button").focus():f.open(c)}})).appendTo(h);var i=a("<ul />",{"class":e.optionsClass});b.children("option:not(:selected),optgroup").each(function(){if(a(this).is("optgroup")){i.append(a("<li />",{"class":e.optClass}).append(a("<span />",{text:a(this).attr("label")})));var d=a("<ul />");a(this).children().each(function(){f.buildLi(this).appendTo(d)});i.find("li."+e.optClass+":last").append(d)}else f.buildLi(this).appendTo(i)}); c.buttons=i.find("li."+e.optionClass+" button");h.append(a("<li />").append(i));c.element=h.delegate("li.option button","click.rock",function(d){var k=a(d.target);b.val(a(d.target).data("val"));h.find("button.handle").text(k.text()).attr("aria-valuetext",k.text());f.close(c);e.onChange.call(b)}).delegate("li.option button,.handle","keydown.rock",function(d){if(d.keyCode>=49&&d.keyCode<=90){d.preventDefault();a.each(m,function(){window.clearTimeout(this)});var k=window.setTimeout(function(){j=""}, e.timeout);m.push(k);j+=String.fromCharCode(d.keyCode);c.buttons.each(function(g){if(a(this).text().toLowerCase().indexOf(j.toLowerCase())===0){a(this).hover().focus();return false}if(g===c.buttons.length-1)j=""})}if(d.keyCode===40||d.keyCode===38){d.preventDefault();c.buttons.each(function(g,o){if(d.target===o)if(d.keyCode===40){if(g+1<c.buttons.length){d.preventDefault();c.buttons.get(g+1).focus()}}else if(g>0){d.preventDefault();c.buttons.get(g-1).focus()}})}}).delegate("li."+e.optionClass,"mouseover", function(){a(this).find("button").focus()}).insertAfter(b);b.bind("change",function(){b=a(this);h.find("button.handle").text(b.find("option[value="+b.val()+"]").text())});n.push(c)})}})(jQuery);